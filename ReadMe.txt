This code has been adapted from the MSDN article:
http://msdn.microsoft.com/en-us/magazine/jj190808.aspx

It has been modified to use LINQ and to more closely
follow some best practice C# conventions.